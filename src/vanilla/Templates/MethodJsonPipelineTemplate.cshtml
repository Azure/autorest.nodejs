@using System.Linq;
@using AutoRest.NodeJS.Model
@inherits AutoRest.Core.Template<AutoRest.NodeJS.Model.MethodJs>
// Send Request
return client.pipeline(httpRequest, (err, response, responseBody) => {
  if (err) {
    return callback(err);
  }
  let statusCode = response.statusCode;
  if (@(Model.FailureStatusCodePredicate)) {
    let error = new Error(responseBody);
    error.statusCode = response.statusCode;
    error.request = msRest.stripRequest(httpRequest);
    error.response = msRest.stripResponse(response);
    if (responseBody === '') responseBody = null;
    let parsedErrorResponse;
    try {
      parsedErrorResponse = JSON.parse(responseBody);
      if (parsedErrorResponse) {
        @(Model.PopulateErrorCodeAndMessage())
      }
  @if (Model.DefaultResponse.Body != null)
  {
      var deserializeErrorBody = Model.GetDeserializationString(Model.DefaultResponse.Body, "error.body", "parsedErrorResponse");
      if (!string.IsNullOrWhiteSpace(deserializeErrorBody))
      {
@:      if (parsedErrorResponse !== null && parsedErrorResponse !== undefined) {
@:        @(deserializeErrorBody)
@:      }
      }
  }
    } catch (defaultError) {
      error.message = `Error "${defaultError.message}" occurred in deserializing the responseBody ` + 
                       `- "${responseBody}" for the default response.`;
      return callback(error);
    }
    return callback(error);
  }

  // Create Result
  let result = null;
  if (responseBody === '') responseBody = null;
  @Model.InitializeResult
  @foreach (var responsePair in Model.Responses.Where(r => r.Value.Body != null))
  {
      <text>
  // Deserialize Response
  if (statusCode === @MethodJs.GetStatusCodeReference(responsePair.Key)) {
    @(Model.DeserializeResponse(responsePair.Value.Body))
  }
      </text>
  }
  @if (Model.ReturnType.Body != null && Model.DefaultResponse.Body != null && !Model.Responses.Any())
  {
    @(Model.DeserializeResponse(Model.DefaultResponse.Body))
  }
  @EmptyLine

  return callback(null, result, httpRequest, response);
});